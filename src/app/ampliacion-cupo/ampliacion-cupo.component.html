<app-header breadcrumbs="Ampliación de cupo"></app-header>

<div id="wrapper">
    <div class="opciones">
        <app-menu></app-menu>
    </div>
    <div class="contenido contenido-ampliacion">

        <div class="filtros filtro-ampliacion">
            <div class="box-buscador t-0">
                <img class="lupa" src="./assets/img/search.svg" alt="" >
                <input name="buscador" class="buscador" placeholder="buscar" (keyup)="searchTable($event)" type="text">
                <button type="button" class="hidden"></button>
            </div>

            <div class="box-editar t-0" (click)="accionesEncuestas()">
                <span class="texto-editar">Acción de</span>
                <div class="icono-puntos">
                    <img src="./assets/img/edit_points.svg" alt="">
                </div>

                <ul class="acciones-solicitud">
                    <li (click)="editarSolicitud()">
                        <img src="./assets/img/editar.svg" alt=""> Editar
                    </li>
                    <li (click)="exporter.exportTable('xlsx', {fileName:'ampliacion_cupo'})"><img src="./assets/img/icons-filter/export.svg" alt=""> Exportar</li>
                </ul>
            </div>

            <div class="box-create-new t-0">
                <div class="box-mas">
                    <img class="mas" src="./assets/img/mas.svg" alt="">
                </div>
                <a class="btn-nuevo-cliente"  data-toggle="modal" data-target="#crearSolicitud">Nueva Solicitud</a>
            </div>
        </div>


        <section class="table-data">
            <table mat-table [dataSource]="dataSource" matTableExporter  #exporter="matTableExporter">
                <ng-container matColumnDef="select">
                    <th mat-header-cell *matHeaderCellDef>
                        <mat-checkbox (change)="$event ? masterToggle() : null"
                            [checked]="selection.hasValue() && isAllSelected()"
                            [indeterminate]="selection.hasValue() && !isAllSelected()"
                            [aria-label]="checkboxLabel()">
                        </mat-checkbox>
                    </th>
                    <td mat-cell *matCellDef="let solicitud; let i = index">
                        <mat-checkbox (click)="$event.stopPropagation()"
                        (click)="checkBoxSolicitud(solicitud, i)"
                            (change)="$event ? selection.toggle(solicitud) : null"
                            [checked]="selection.isSelected(solicitud)"
                            [aria-label]="checkboxLabel(solicitud)">
                        </mat-checkbox>
                    </td>
                </ng-container>
                <ng-container matColumnDef="solicitud">
                    <th mat-header-cell *matHeaderCellDef>#Solicitud</th>
                    <td mat-cell *matCellDef="let solicitud">{{ solicitud.codigo_solicitud }}</td>
                </ng-container>
                <ng-container matColumnDef="fecha_creacion">
                    <th mat-header-cell *matHeaderCellDef>Fecha de creación</th>
                    <td mat-cell *matCellDef="let solicitud">{{ solicitud.fecha_solicitud }}</td>
                </ng-container>
                <ng-container matColumnDef="monto">
                    <th mat-header-cell *matHeaderCellDef>Monto</th>
                    <td mat-cell *matCellDef="let solicitud">{{ solicitud.monto |currency:'COP':'symbol-narrow' :'1.0-0' }}</td>
                </ng-container>
                <ng-container matColumnDef="vendedor">
                    <th mat-header-cell *matHeaderCellDef>Vendedor</th>
                    <td mat-cell *matCellDef="let solicitud">{{ solicitud.name +' '+solicitud.apellidos }}</td>
                </ng-container>
                <ng-container matColumnDef="estado">
                    <th mat-header-cell *matHeaderCellDef>Estado</th>
                    <td mat-cell *matCellDef="let solicitud">
                        <div *ngIf="solicitud.estado == 'pendiente'; else estado" class="txt-capitalize">
                            <a class="change-state text-capitalize" (click)="setChangeState(solicitud)">
                                {{solicitud.estado}}
                            </a> 
                        </div>
                        <ng-template #estado>
                                <span class="text-capitalize">{{ solicitud.estado }}</span>
                        </ng-template>
                    </td>
                </ng-container>
                <ng-container matColumnDef="documentos">
                    <th mat-header-cell *matHeaderCellDef></th>
                    <td mat-cell *matCellDef="let solicitud">
                        <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Example icon-button with a menu">
                            <i class="fa fa-ellipsis-v" style="font-size: 20px;"></i>
                        </button>
                            <mat-menu #menu="matMenu">
                            <a class="txt-hover-black" target="_blank" mat-menu-item [href]="solicitud.doc_identidad">
                                Doc. Identidad
                            </a>
                            <a class="txt-hover-black" target="_blank" mat-menu-item [href]="solicitud.doc_rut">
                                RUT
                            </a>
                            <a class="txt-hover-black" target="_blank" mat-menu-item [href]="solicitud.doc_camara_com">
                                Camara comercio
                            </a>
                        </mat-menu>
                    </td>
                </ng-container>
                <tr mat-header-row *matHeaderRowDef="columns"></tr>
                <tr mat-row *matRowDef="let row; columns: columns"></tr>
            </table>
            <mat-paginator class="fijar-abajo" [pageSizeOptions]="[20, 50, 100]" showFirstLastButtons></mat-paginator>
        </section>
    </div>
</div>

  <!-- Modal crear solicitud -->
<div class="modal fade" id="crearSolicitud" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-body">
            <form (submit)="submitSolicitud()">
                <p class="title-solicitud">Realiza tu solicitud</p>
                <div class="label-field">
                    <label >Vendedor</label>
                    <select name="vendedor" [(ngModel)]="createSolicitud.vendedor" [ngModelOptions]="{standalone: true}" required>
                        <option value="">Seleccione...</option>
                        <option *ngFor="let vendedor of vendedores" [value]="vendedor.id">
                            {{vendedor.name + ' ' + vendedor.apellidos}}
                        </option>
                    </select>
                    <small *ngIf="vendedorBool"><span class="text-danger">{{error.vendedor}}</span></small>
                </div>
                <div class="label-field">
                    <label >cliente</label>
                    <select name="cliente" [(ngModel)]="createSolicitud.cliente" [ngModelOptions]="{standalone: true}" required>
                        <option value="">Seleccione...</option>
                        <option *ngFor="let cliente of clientes" [value]="cliente.id">
                            {{cliente.name + ' ' + cliente.apellidos}}
                        </option>
                    </select>
                    <small *ngIf="clienteBool"><span class="text-danger">{{error.cliente}}</span></small>
                </div>
                <div class="label-field">
                    <label >Adjuntar documento de identidad</label>
                    <div class="custom-file">
                        <span id="doc_identidad"></span>
                        <small *ngIf="doc_identidadBool"><span class="text-danger">{{error.doc_identidad}}</span></small>
                        <label class="custom-file-label" for="customFileLang1">{{name_files.doc_identidad}}</label>
                    </div>
                </div>
                <div class="label-field">
                    <label >Adjuntar RUT</label>
                    <div class="custom-file">
                        <span id="doc_rut"></span>
                        <small *ngIf="doc_rutBool"><span class="text-danger">{{error.doc_rut}}</span></small>
                        <label class="custom-file-label" for="customFileLang2">{{name_files.doc_rut}}</label>
                    </div>
                </div>
                <div class="label-field">
                    <label >Adjuntar cámara de comercio</label>
                    <div class="custom-file">
                        <span id="doc_camara_com"></span>
                        <small *ngIf="doc_camara_comBool"><span class="text-danger">{{error.doc_camara_com}}</span></small>
                        <label class="custom-file-label" for="customFileLang3">{{name_files.doc_camara_com}}</label>
                    </div>
                </div>
                <div class="text-ampliar-cupo">
                    <p>Por favor coloque el monto por el cual desea solicitar ampliacion de cupo</p>
                </div>
                <div class="label-field">
                    <label >monto</label>
                    <input type="text" [(ngModel)]="createSolicitud.monto" [ngModelOptions]="{standalone: true}" required>
                    <small *ngIf="montoBool"><span class="text-danger">{{error.monto}}</span></small>
                </div>
                <div class="enviar-solicitud">
                    <div class="box-create-new">
                        <div class="box-mas">
                            <img class="mas" src="./assets/img/enviar.png" alt="">
                        </div>
                        <button type="submit" class="btn-enviar-solicitud">Enviar</button>
                    </div>
                </div>
            </form>
        </div>
      </div>
    </div>
</div>

  <!-- Modal editar solicitud -->
<div class="modal fade" id="editarSolicitud" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-body">
            <form (submit)="submitUpdateSolicitud()">
                <p class="title-solicitud">Editar tu solicitud</p>
                <div class="label-field">
                    <label >Vendedor</label>
                    <select name="vendedor" id="vendedor" [(ngModel)]="editSolicitud.vendedor" [ngModelOptions]="{standalone: true}" required>
                        <option value="">Seleccione...</option>
                        <option *ngFor="let vendedor of vendedores" [value]="vendedor.id">
                            {{vendedor.name + ' ' + vendedor.apellidos}}
                        </option>
                    </select>
                </div>
                <div class="label-field">
                    <label >cliente</label>
                    <select name="cliente" id="cliente" [(ngModel)]="editSolicitud.cliente" [ngModelOptions]="{standalone: true}" required>
                        <option value="">Seleccione...</option>
                        <option *ngFor="let cliente of clientes" [value]="cliente.id">
                            {{cliente.name + ' ' + cliente.apellidos}}
                        </option>
                    </select>
                </div>
                <div class="label-field">
                    <label >Adjuntar documento de identidad</label>
                    <div class="custom-file">
                        <input type="file" id="doc_identidad" (change)="onFileChange($event.target.files,'doc_identidad', 'editSolicitud')" 
                        class="custom-file-input" id="customFileLang" lang="es" accept="image/jpeg,image/gif,image/png,application/pdf" required>
                        <label class="custom-file-label" for="customFileLang">{{name_files.doc_identidad}}</label>
                    </div>
                </div>
                <div class="label-field">
                    <label >Adjuntar RUT</label>
                    <div class="custom-file">
                        <input type="file" id="doc_rut" (change)="onFileChange($event.target.files,'doc_rut', 'editSolicitud')" 
                        class="custom-file-input" id="customFileLang" lang="es" accept="image/jpeg,image/gif,image/png,application/pdf" required>
                        <label class="custom-file-label" for="customFileLang">{{name_files.doc_rut}}</label>
                    </div>
                </div>
                <div class="label-field">
                    <label >Adjuntar cámara de comercio</label>
                    <div class="custom-file">
                        <input type="file" id="doc_camara_com" (change)="onFileChange($event.target.files,'doc_camara_com', 'editSolicitud')" 
                        class="custom-file-input" id="customFileLang" lang="es" accept="image/jpeg,image/gif,image/png,application/pdf" required>
                        <label class="custom-file-label" for="customFileLang">{{name_files.doc_camara_com}}</label>
                    </div>
                </div>
                <div class="text-ampliar-cupo">
                    <p>Por favor coloque el monto por el cual desea solicitar ampliacion de cupo</p>
                </div>
                <div class="label-field">
                    <label >monto</label>
                    <input type="text" name="monto" id="monto" [(ngModel)]="editSolicitud.monto" [ngModelOptions]="{standalone: true}" required>
                </div>
                <div class="enviar-solicitud">
                    <div class="box-create-new">
                        <div class="box-mas">
                            <img class="mas" src="./assets/img/enviar.png" alt="">
                        </div>
                        <button type="submit" class="btn-enviar-solicitud">Enviar</button>
                    </div>
                </div>
            </form>
        </div>
      </div>
    </div>
</div>

  <!-- Modal editar solicitud -->
<div class="modal fade" id="changeState" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-body">
            <form (submit)="changeState()">
                <p class="title-solicitud">Cambiar estado</p>
                <div class="label-field">
                    <label >estado</label>
                    <select name="estado" [(ngModel)]="selectChangeState.estado" [ngModelOptions]="{standalone: true}">
                        <option value="">Seleccione...</option>
                        <option value="pendiente">Pendiente</option>
                        <option value="aceptado">Aceptado</option>
                        <option value="rechazado">Rechazado</option>
                    </select>
                </div>
            
                <div class="enviar-solicitud">
                    <div class="box-create-new">
                        <div class="box-mas">
                            <img class="mas" src="./assets/img/enviar.png" alt="">
                        </div>
                        <button type="submit" class="btn-enviar-solicitud">Cambiar</button>
                    </div>
                </div>
            </form>
        </div>
      </div>
    </div>
</div>