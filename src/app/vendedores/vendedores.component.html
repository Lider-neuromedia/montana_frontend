<div *ngIf="access_token; else login">
    <app-header rutaBreadCrumbs1="/users/vendedores" breadcrumbs1="Vendedores"></app-header>
    <div id="wrapper">
    <div class="opciones">
        <app-menu></app-menu>
    </div>
    <div class="contenido">

        <div class="overview"></div>
    <app-drawer-advanced class="form-advanced" name="crear-vendedor" title="Crear Vendedor" [open]="openDrawer" (close)="openDrawerRigth(false, 'create')" (submit)="agregarVendedor()">
                <div class="tabs">
                    <ul>
                        <li><a [class.activeclasstab]="activeDatos" (click)="datosGenerales()">Datos generales</a></li>
                        <li><a [class.activeclasstab]="activeUsuario" (click)="datosCredenciales()">Usuario y contraseña</a></li>
                        <li><a [class.activeclasstab]="asignarCliente" (click)="datosAsignar()">Asignar un cliente</a></li>
                    </ul>
                </div>

                <div class="fields">
                    <div *ngIf="generales" class="field-datos-generales">
                        <div class="label-field">
                            <label for="">Nombres</label>
                            <input [(ngModel)]="vendedor.name" name="nombres" type="text" class="">
                            <small *ngIf="nameBool"><span class="text-danger">{{error.name}}</span></small>
                        </div>

                        <div class="label-field">
                            <label for="">Apellidos</label>
                            <input [(ngModel)]="vendedor.apellidos" name="apellidos" type="text" class="">
                            <small *ngIf="apellidosBool"><span class="text-danger">{{error.apellidos}}</span></small>
                        </div>


                        <div class="label-field">
                            <label for="">Cédula de ciudadanía</label>
                            <input [(ngModel)]="vendedor.dni" name="dni" type="number" class="">
                            <small *ngIf="dniBool"><span class="text-danger">{{error.dni}}</span></small>
                        </div>

                        <div class="label-field">
                            <label for="">Celular</label>
                            <input [(ngModel)]="vendedor.userdata.telefono" name="celular" type="tel" class="">
                            <small *ngIf="telefonoBool"><span class="text-danger">{{error.telefono}}</span></small>
                        </div>

                        <div class="label-field">
                            <label for="">Código de vendedor</label>
                            <input [(ngModel)]="vendedor.userdata.codigo" type="number" name="codigo" class="">
                            <small *ngIf="codigoBool"><span class="text-danger">{{error.codigo}}</span></small>
                        </div>

                    </div>

                    <div *ngIf="credenciales" class="credenciales">
                        <div class="label-field">
                            <label for="">Correo electrónico</label>
                            <input [(ngModel)]="vendedor.email" name="email" type="email" class="">
                            <small *ngIf="emaiBool"><span class="text-danger">{{error.email}}</span></small>
                        </div>

                        <div class="label-field">
                            <label for="">Contraseña</label>
                            <input [(ngModel)]="vendedor.password" name="password" type="password" class="">
                            <small *ngIf="passwordBool"><span class="text-danger">{{error.password}}</span></small>
                        </div>

                        <div class="label-field">
                            <label for="">Confirmar Contraseña</label>
                            <input [(ngModel)]="vendedor.confirm_password" name="confirm_password" type="password"
                                class="">
                                <small *ngIf="confirm_passwordBool"><span class="text-danger">{{error.confirm_password}}</span></small>
                        </div>
                    </div>

                    <div *ngIf="asignar" class="asignar-cliente">
                        <div class="search-cliente">
                            <p>Elige un cliente</p>
                            <mat-form-field class="w-100">
                                <mat-label>Asignar Cliente</mat-label>
                                <input placeholder="Asignar Cliente" matInput [formControl]="asigCliente" [matAutocomplete]="auto">
                                <mat-icon matSuffix>search</mat-icon>
                                <mat-autocomplete #auto="matAutocomplete">
                                    <mat-option *ngFor="let cliente of filteredOptions | async" [value]="cliente" (blur)="asignCliente(cliente)">
                                      {{cliente}}
                                    </mat-option>
                                  </mat-autocomplete>                 
                            </mat-form-field>
                        </div>
                        <div class="list-vendedores">
                            <div class="item-cliente" *ngFor="let cliente of vendedor.clientes" [@fadeIn]>
                                <p> 
                                    <span class="icon-cliente">{{(cliente.name.charAt(0)) + (cliente.apellidos.charAt(0))}}</span> 
                                    {{cliente.name + ' ' + cliente.apellidos}}
                                </p>
                                <p (click)="deleteClientSelect(cliente)" style="cursor: pointer;" class="text-danger"><mat-icon>delete_outline</mat-icon></p>
                            </div>
                        </div>
                    </div>
                </div>
        </app-drawer-advanced>

        <app-drawer-advanced class="form-advanced" name="editar-vendedor" title="Editar Vendedor" [open]="updateDrawer" (close)="openDrawerRigth(false, 'edit')" (submit)="actualizarVendedor()" button="Actualizar">
                <div class="tabs">
                    <ul>
                        <li><a [class.activeclasstab]="activeDatos" (click)="datosGenerales()">Datos generales</a></li>
                        <li><a [class.activeclasstab]="activeUsuario" (click)="datosCredenciales()">Usuario y contraseña</a></li>
                        <li><a [class.activeclasstab]="asignarCliente" (click)="datosAsignar()">Asignar un cliente</a></li>
                    </ul>
                </div>

                <div class="fields">
                    <div *ngIf="generales" class="field-datos-generales">
                        <div class="label-field">
                            <label for="">Nombres</label>
                            <input [(ngModel)]="selectVendedor.name" name="nombres" type="text" class="">
                            <small *ngIf="nameBool"><span class="text-danger">{{ error.name }}</span></small>
                        </div>

                        <div class="label-field">
                            <label for="">Apellidos</label>
                            <input [(ngModel)]="selectVendedor.apellidos" name="apellidos" type="text" class="">
                            <small *ngIf="apellidosBool"><span class="text-danger">{{ error.apellidos }}</span></small>
                        </div>


                        <div class="label-field">
                            <label for="">Cédula de ciudadanía</label>
                            <input [(ngModel)]="selectVendedor.dni" name="dni" type="number" class="">
                            <small *ngIf="dniBool"><span class="text-danger">{{ error.dni }}</span></small>
                        </div>
                        <div class="label-field" *ngFor="let userdata of selectVendedor['data_user']">
                            <label for="">{{userdata.field_key}}</label>
                            <input [(ngModel)]="userdata.value_key" name="celular" type="tel" class="">
                            <small *ngIf="telefonoBool"><span class="text-danger">{{ error.telefono }}</span></small>
                        </div>

                    </div>

                    <div *ngIf="credenciales" class="credenciales">
                        <div class="label-field">
                            <label for="">Correo electrónico</label>
                            <input [(ngModel)]="selectVendedor.email" name="email" type="email" class="">
                            <small *ngIf="emaiBool"><span class="text-danger">{{ error.email }}</span></small>
                        </div>

                        <div class="label-field">
                            <label for="">Contraseña</label>
                            <input [(ngModel)]="selectVendedor.password" name="password" type="password" class="">
                            <small *ngIf="passwordBool"><span class="text-danger">{{ error.password }}</span></small>
                        </div>

                        <div class="label-field">
                            <label for="">Confirmar Contraseña</label>
                            <input [(ngModel)]="selectVendedor.confirm_password" name="confirm_password" type="password"
                                class="">
                                <small *ngIf="confirm_passwordBool"><span class="text-danger">{{ error.confirm_password }}</span></small>
                        </div>
                    </div>

                    <div *ngIf="asignar" class="asignar-cliente">
                        <div class="search-cliente">
                            <p>Elige un cliente</p>
                            <mat-form-field class="w-100">
                                <mat-label>Asignar Cliente</mat-label>
                                <input placeholder="Asignar Cliente" matInput [formControl]="asigCliente" [matAutocomplete]="auto">
                                <mat-icon matSuffix>search</mat-icon>
                                <mat-autocomplete #auto="matAutocomplete">
                                    <mat-option *ngFor="let cliente of filteredOptions | async" [value]="cliente" (blur)="updateAsignCliente(cliente)">
                                      {{cliente}}
                                    </mat-option>
                                  </mat-autocomplete>                               
                            </mat-form-field>
                        </div>
                        <div class="list-vendedores">
                            <div class="item-cliente" *ngFor="let cliente of selectVendedor.clientes" [@fadeIn]>
                                <p> 
                                    <span class="icon-cliente">{{(cliente.name?.charAt(0)) + (cliente.apellidos?.charAt(0))}}</span> 
                                    {{cliente.name + ' ' + cliente.apellidos}}
                                </p>
                                <p (click)="deleteAsignClient(cliente)" style="cursor: pointer;" class="text-danger"><mat-icon>delete_outline</mat-icon></p>
                            </div>
                        </div>
                    </div>
                </div>
        </app-drawer-advanced>

    <div class="filtros" style="top: 6px; left: 14rem;padding-top: 1rem;padding-bottom: 1rem;">
            <div class="box-buscador t-0">
                <img class="lupa" [src]="templateImage.lupa" alt="">
                <input class="buscador" placeholder="Buscar" (keyup)="filtro($event)" type="text" #input>
            </div>
            <div (click)="accionesVendedor()" class="box-editar t-0">
                <span class="texto-editar">Acción de</span>
                <div class="icono-puntos">
                    <img [src]="templateImage.points" alt="">
                </div>
                <ul class="acciones-vendedor">
                    <li (click)="editTienda()">
                        <img [src]="templateImage.lapiz" alt=""> Editar
                    </li>
                    <li (click)="exporter.exportTable('xlsx', {fileName:'vendedores'})"><img [src]="templateImage.exportar" alt=""> Exportar</li>
                    <li (click)="getUsersAndDelete()"><img [src]="templateImage.eliminar" alt=""> Eliminar</li>
                </ul>
            </div>
            <div class="box-create-new t-0">
                <div class="box-mas">
                    <img class="mas" src="./assets/img/mas.svg" alt="">
                </div>
                <a class="btn-nuevo-cliente" (click)="openDrawerRigth(true, 'create')">Nuevo vendedor</a>
            </div>
        </div>

        <section class="table-data">
            <table mat-table [dataSource]="dataSource" matSort matTableExporter #exporter="matTableExporter">
                <ng-container matColumnDef="select">
                    <th mat-header-cell *matHeaderCellDef>
                        <mat-checkbox (change)="$event ? masterToggle() : null"
                            [checked]="selection.hasValue() && isAllSelected()"
                            [indeterminate]="selection.hasValue() && !isAllSelected()"
                            [aria-label]="checkboxLabel()">
                        </mat-checkbox>
                    </th>
                    <td mat-cell *matCellDef="let user; let i = index">
                        <mat-checkbox (click)="$event.stopPropagation()"
                            (click)="selectVendCheckbox(user, i)"
                            (change)="$event ? selection.toggle(user) : null"
                            [checked]="selection.isSelected(user)"
                            [aria-label]="checkboxLabel(user)">
                        </mat-checkbox>
                    </td>
                </ng-container>
                <ng-container matColumnDef="Nombre">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header><span class="tituloNombre">Nombre</span></th>
                    <td mat-cell *matCellDef="let vendedor" (click)="vendedorDetalle(vendedor.id)" style="cursor: pointer;">
                        <div class="iniciales" style="margin-left: -1.5rem;margin-top: -4.5px;"> {{vendedor.iniciales}} </div>
                        <p class="nombre">{{ vendedor.name }} {{ vendedor.apellidos }}</p></td>
                </ng-container>
                <ng-container matColumnDef="Teléfono">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Teléfono</th>
                    <td mat-cell *matCellDef="let vendedor" (click)="vendedorDetalle(vendedor.id)" style="cursor: pointer;">{{ vendedor['user_data'][0]?.value_key }}</td>
                </ng-container>
                <ng-container matColumnDef="Código">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Código</th>
                    <td mat-cell *matCellDef="let vendedor" (click)="vendedorDetalle(vendedor.id)" style="cursor: pointer;">{{ vendedor['user_data'][1]?.value_key }}</td>
                </ng-container>
                <ng-container matColumnDef="Correo">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Correo</th>
                    <td mat-cell *matCellDef="let vendedor" (click)="vendedorDetalle(vendedor.id)" style="cursor: pointer;">{{ vendedor.email }}</td>
                </ng-container>
                <tr mat-header-row *matHeaderRowDef="columns"></tr>
                <tr mat-row *matRowDef="let row; columns: columns"></tr>
                <tr class="mat-row" *matNoDataRow>
                    <td class="mat-cell" colspan="4">No se encuentra el dato filtrado "{{ input.value }}"</td>
                </tr>
            </table>
            <mat-paginator class="fijar-abajo" [pageSizeOptions]="[20, 50, 100]" showFirstLastButtons></mat-paginator>
        </section>
    </div>
</div>
</div>
<ng-template #login>
    <app-login></app-login>
</ng-template>